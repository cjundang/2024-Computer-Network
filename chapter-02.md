# Chapter 2 - Connecting to the World

### Learning Outcomes  

* **LO1:** อธิบาย (Explain) โครงสร้างและหน้าที่ขององค์ประกอบหลักในเครือข่ายไอพี (IP Address, Subnet Mask, Default Gateway, DNS) และการทำงานร่วมกันเพื่อให้การสื่อสารเกิดขึ้นได้อย่างถูกต้อง

* **LO2:** แปลความ (Interpret) การกำหนดที่อยู่ไอพี (IPv4/IPv6) และการทำ Subnetting ในระดับพื้นฐาน เพื่อทำความเข้าใจการแบ่งเครือข่ายและขอบเขตของโฮสต์

* **LO3:** สรุป (Summarize) การทำงานของ DHCP และเครื่องมือบรรทัดคำสั่งที่ใช้ในการตรวจสอบและแก้ไขปัญหาเครือข่าย พร้อมระบุอาการและแนวทางแก้ไขปัญหาการเชื่อมต่อที่พบบ่อย


## Section 1: คำจำกัดความ (Definitions)

### การกำหนดที่อยู่ไอพี (IP Addressing)

**ที่อยู่ไอพี (IP Address)** คือ ตัวระบุเชิงตัวเลขที่ถูกกำหนดให้กับอุปกรณ์แต่ละตัวในเครือข่ายเพื่อใช้ในการสื่อสาร ทุกอุปกรณ์ที่เชื่อมต่อกับเครือข่าย ไม่ว่าจะเป็นเครือข่ายท้องถิ่นหรืออินเทอร์เน็ต จำเป็นต้องมีที่อยู่ไอพีที่ไม่ซ้ำกัน

ปัจจุบันการกำหนดที่อยู่ไอพีมีอยู่สองเวอร์ชันหลัก ได้แก่

* **IPv4**: รูปแบบที่ใช้กันอย่างแพร่หลายที่สุด ประกอบด้วยเลขฐานสองขนาด 32 บิต มักเขียนในรูปแบบทศนิยมมีจุด เช่น `192.168.1.1`
* **IPv6**: รูปแบบใหม่ที่ถูกพัฒนาขึ้นเพื่อแก้ปัญหาการขาดแคลนที่อยู่ของ IPv4 โดยมีขนาด 128 บิต และเขียนในรูปแบบฐานสิบหก เช่น `2001:db8::1`

ที่อยู่ไอพียังสามารถจำแนกตามการใช้งานและขอบเขต (scope) ได้ดังนี้

| **ประเภท**     | **คำอธิบาย**                                                                                     | **ตัวอย่าง** |
| -------------- | ------------------------------------------------------------------------------------------------ | ------------ |
| **Public IP**  | สามารถถูกกำหนดเส้นทาง (routable) บนอินเทอร์เน็ต ได้รับการจัดสรรโดยผู้ให้บริการอินเทอร์เน็ต (ISP) | 8.8.8.8      |
| **Private IP** | ใช้ภายในเครือข่ายท้องถิ่น ไม่สามารถกำหนดเส้นทางบนอินเทอร์เน็ตได้ เช่น 192.168.x.x, 10.x.x.x      | 192.168.1.10 |
| **APIPA**      | ที่อยู่ซึ่งระบบกำหนดให้อัตโนมัติเมื่อไม่พบ DHCP ใช้เพื่อการสื่อสารภายในเครือข่ายจำกัดเท่านั้น    | 169.254.x.x  |
| **Loopback**   | ใช้สำหรับทดสอบการทำงานของ TCP/IP stack ภายในเครื่องตนเอง (host)                                  | 127.0.0.1    |

การทำความเข้าใจประเภทของที่อยู่เหล่านี้มีความสำคัญต่อการออกแบบและการแก้ปัญหาเครือข่าย เช่น หากอุปกรณ์ได้รับที่อยู่ APIPA แสดงว่ามีปัญหากับการทำงานของ DHCP และจะไม่สามารถเข้าถึงอินเทอร์เน็ตได้ ในขณะที่ **Public IP** มีความจำเป็นสำหรับการให้บริการที่ต้องเข้าถึงจากภายนอกเครือข่าย

### มาสก์เครือข่ายย่อย (Subnet Mask)

**Subnet Mask** คือ ค่าที่ใช้ในการแบ่งที่อยู่ไอพีออกเป็นสองส่วน ได้แก่

1. **ส่วนเครือข่าย (Network portion)** – ใช้ระบุเครือข่ายย่อย (subnet)
2. **ส่วนโฮสต์ (Host portion)** – ใช้ระบุอุปกรณ์ภายในเครือข่ายย่อยนั้น

การทำ subnetting ช่วยให้สามารถแบ่งเครือข่ายออกเป็นกลุ่มย่อยได้อย่างมีประสิทธิภาพ เพิ่มความเป็นระเบียบ ความปลอดภัย และลดความซับซ้อนของการจัดการเครือข่าย

Subnet mask ทำงานร่วมกับที่อยู่ไอพีเพื่อตัดสินว่า อุปกรณ์ปลายทางอยู่ในเครือข่ายท้องถิ่นเดียวกัน หรือจำเป็นต้องส่งข้อมูลออกไปยัง **Gateway**

#### การกำหนดที่อยู่แบบ Classful (Classful IP Addressing)

ในยุคแรกของเครือข่าย ที่อยู่ไอพีถูกกำหนดโดยใช้ระบบ **Classful** ซึ่งแบ่งพื้นที่ที่อยู่ (address space) ออกเป็นคลาส แต่ละคลาสมี **Subnet Mask** มาตรฐานและช่วงการใช้งาน

| **คลาส** | **ช่วงที่อยู่**             | **Subnet Mask มาตรฐาน** | **การใช้งาน**       |
| -------- | --------------------------- | ----------------------- | ------------------- |
| A        | 1.0.0.0 – 126.255.255.255   | 255.0.0.0 (/8)          | เครือข่ายขนาดใหญ่   |
| B        | 128.0.0.0 – 191.255.255.255 | 255.255.0.0 (/16)       | เครือข่ายขนาดกลาง   |
| C        | 192.0.0.0 – 223.255.255.255 | 255.255.255.0 (/24)     | เครือข่ายขนาดเล็ก   |
| D        | 224.0.0.0 – 239.255.255.255 | N/A                     | การส่งแบบ Multicast |
| E        | 240.0.0.0 – 255.255.255.255 | N/A                     | ใช้เพื่อการวิจัย    |

แม้การกำหนดแบบ Classful จะช่วยจัดระบบเครือข่ายในช่วงแรก แต่ไม่ยืดหยุ่นพอและทำให้เกิดการสิ้นเปลืองที่อยู่จำนวนมาก

#### การกำหนดที่อยู่แบบไม่มีคลาส (Classless Addressing / CIDR)

ปัจจุบันใช้ **CIDR (Classless Inter-Domain Routing)** เพื่อแบ่งเครือข่ายได้อย่างยืดหยุ่นมากขึ้น โดยใช้สัญลักษณ์ **Slash Notation** (`/`) เพื่อบอกจำนวนบิตที่เป็นส่วนเครือข่าย

เช่น `192.168.1.0/24` หมายถึง 24 บิตแรกเป็นส่วนของเครือข่าย

ตัวอย่าง:

| **Subnet Mask** | **CIDR** | **จำนวนโฮสต์ที่ใช้ได้** |
| --------------- | -------- | ----------------------: |
| 255.255.255.0   | /24      |                     254 |
| 255.255.255.192 | /26      |                      62 |
| 255.255.255.255 | /32      |                       1 |

ดังนั้น:

* **/24** มี 256 ที่อยู่ (254 ใช้งานได้)
* **/26** มี 64 ที่อยู่ (62 ใช้งานได้)
* **/32** ใช้แทนอุปกรณ์เพียงเครื่องเดียว เช่น loopback หรือ static route

CIDR ยังช่วยลดความซับซ้อนของตารางเส้นทาง (routing table) และเพิ่มประสิทธิภาพของการจัดการที่อยู่บนอินเทอร์เน็ตและองค์กรขนาดใหญ่


### เกตเวย์เริ่มต้น (Default Gateway)

**Default Gateway** คืออุปกรณ์เครือข่าย (โดยมากคือเราเตอร์) ที่ทำหน้าที่เป็นจุดเชื่อมต่อสำหรับการส่งข้อมูลออกจากเครือข่ายท้องถิ่นไปยังเครือข่ายอื่น เช่น อินเทอร์เน็ต

**ตัวอย่าง**:

* IP Address: `192.168.1.100`
* Subnet Mask: `255.255.255.0`
* Default Gateway: `192.168.1.1`

อุปกรณ์จะตีความว่าอยู่ในเครือข่าย `192.168.1.0/24` หากต้องการเข้าถึงเว็บไซต์ภายนอก เช่น `93.184.216.34` ข้อมูลจะถูกส่งไปยัง Gateway (`192.168.1.1`) เพื่อทำการกำหนดเส้นทางต่อ

ในเครือข่ายบ้านหรือสำนักงานขนาดเล็ก อุปกรณ์ **Router** มักทำหน้าที่ทั้งเป็น **NAT** และ **Default Gateway** ซึ่งกำหนดค่าได้ทั้งแบบ manual และผ่าน **DHCP**


### ระบบชื่อโดเมน (Domain Name System: DNS)

**DNS (Domain Name System)** เป็นบริการที่ใช้แปลงชื่อโดเมนที่มนุษย์เข้าใจได้ (เช่น `www.google.com`) ไปเป็นที่อยู่ไอพี (เช่น `142.250.190.14`) เพื่อให้คอมพิวเตอร์สามารถเชื่อมต่อได้โดยไม่ต้องจำเลขที่อยู่

#### ประเภทของ DNS Record ที่พบบ่อย

| **Record Type** | **วัตถุประสงค์**                                        |
| --------------- | ------------------------------------------------------- |
| **A**           | แปลงโดเมนไปยัง IPv4                                     |
| **AAAA**        | แปลงโดเมนไปยัง IPv6                                     |
| **CNAME**       | กำหนดชื่อแทน (alias) ให้กับโดเมนหนึ่งไปยังอีกโดเมนหนึ่ง |
| **MX**          | ระบุเซิร์ฟเวอร์อีเมลที่รับผิดชอบการส่งเมลของโดเมนนั้น   |

**ตัวอย่างการทำงาน**:

1. ผู้ใช้พิมพ์ `www.example.com`
2. เครื่องจะส่งคำถามไปยัง DNS Server (เช่น `8.8.8.8`)
3. DNS Server ตอบกลับด้วยที่อยู่ไอพี เช่น `93.184.216.34`
4. เบราว์เซอร์ใช้ไอพีนี้เพื่อติดต่อกับเว็บไซต์

DNS ถือเป็นโครงสร้างพื้นฐานสำคัญของอินเทอร์เน็ต หากการตั้งค่า DNS ไม่ถูกต้อง จะทำให้เกิดข้อผิดพลาดเช่น “server not found” แม้จะยังเชื่อมต่ออินเทอร์เน็ตได้อยู่

## Section 2: ความเข้าใจพื้นฐานของเครือข่ายไอพี (Understanding a Basic IP Network)

ก่อนที่จะเข้าสู่ระบบเครือข่ายระดับองค์กรที่ซับซ้อน จำเป็นต้องทำความเข้าใจว่า **เครือข่ายพื้นฐาน** สามารถทำให้อุปกรณ์หนึ่งสื่อสารกับอินเทอร์เน็ตได้อย่างไร เครือข่ายขนาดเล็ก เช่น ในบ้าน ห้องเรียน หรือสำนักงานขนาดย่อม ใช้องค์ประกอบพื้นฐานเพียงไม่กี่อย่างเพื่อให้การเข้าถึงเครือข่ายเป็นไปอย่างมีประสิทธิภาพ

องค์ประกอบหลักประกอบด้วย:

* **ที่อยู่ไอพี (IP Address)** – ระบุตัวตนเฉพาะของอุปกรณ์
* **มาสก์เครือข่ายย่อย (Subnet Mask)** – แยกส่วนเครือข่ายกับส่วนโฮสต์
* **เกตเวย์เริ่มต้น (Default Gateway)** – เส้นทางออกไปยังเครือข่ายภายนอก
* **เซิร์ฟเวอร์ DNS (Domain Name System)** – แปลงชื่อโดเมนให้เป็นที่อยู่ไอพี

โครงสร้างพื้นฐานที่เรียบง่ายนี้สามารถพบได้ทั่วไป เช่น เครือข่ายที่มีคอมพิวเตอร์เครื่องลูกข่ายหนึ่งเครื่อง เราเตอร์ไร้สายที่ทำหน้าที่ทั้งเป็น **Gateway** และ **DHCP Server** รวมถึงการอ้างอิงไปยัง **DNS Server** ภายนอก (เช่น 8.8.8.8 ของ Google)

### ตัวอย่างการกำหนดค่าเครือข่าย

* **IP Address:** `192.168.1.10`
* **Subnet Mask:** `255.255.255.0`
* **Default Gateway:** `192.168.1.1`
* **DNS Server:** `8.8.8.8`

ด้วยการกำหนดค่าเช่นนี้ อุปกรณ์จะเข้าใจว่าตนอยู่ในเครือข่าย `192.168.1.0/24`

* หากต้องการติดต่อกับอุปกรณ์ในเครือข่ายเดียวกัน (LAN) เช่น `192.168.1.20` การสื่อสารจะเกิดขึ้นโดยตรงภายในเครือข่าย
* หากต้องการติดต่อกับอุปกรณ์ภายนอก เช่น เว็บไซต์ `www.example.com` ที่มีที่อยู่ไอพี `93.184.216.34` การสื่อสารจะถูกส่งไปยัง **Default Gateway (`192.168.1.1`)** ซึ่งจะกำหนดเส้นทางออกสู่อินเทอร์เน็ต


### บทบาทของเราเตอร์ในเครือข่ายพื้นฐาน

ในเครือข่ายบ้านหรือสำนักงานขนาดเล็ก เราเตอร์มักทำหน้าที่หลายอย่างพร้อมกัน ได้แก่:

1. **Default Gateway** – เส้นทางหลักสำหรับการเข้าถึงเครือข่ายภายนอก
2. **DHCP Server** – แจกจ่ายที่อยู่ไอพีและการตั้งค่าเครือข่ายอัตโนมัติให้กับอุปกรณ์
3. **NAT (Network Address Translation)** – แปลงที่อยู่ไอพีภายใน (Private IP) ให้ออกไปใช้งานได้บนอินเทอร์เน็ตผ่านที่อยู่ไอพีสาธารณะ (Public IP)

### ความสำคัญต่อการเรียนรู้

การเข้าใจการทำงานร่วมกันขององค์ประกอบทั้งสี่ (**IP Address, Subnet Mask, Default Gateway, DNS**) ถือเป็นพื้นฐานที่สำคัญของการแก้ปัญหาเครือข่าย หากองค์ประกอบใดองค์ประกอบหนึ่งถูกกำหนดค่าผิดพลาด อุปกรณ์อาจ:

* ไม่สามารถเชื่อมต่อกับเครือข่ายท้องถิ่นได้
* ไม่สามารถเข้าถึงอินเทอร์เน็ตได้
* เข้าถึงเว็บไซต์ไม่ได้แม้จะมีการเชื่อมต่ออินเทอร์เน็ต (หาก DNS ทำงานผิดพลาด)

ทักษะเหล่านี้ยังเป็นหัวใจสำคัญในข้อสอบประกาศนียบัตรด้านเครือข่าย เช่น **CompTIA Network+** และ **Cisco CCNA**

## Section 3: เครื่องมือบรรทัดคำสั่งที่ใช้บ่อยในเครือข่าย (Common Network Command-line Tools)

เครื่องมือบรรทัดคำสั่ง (Command-line Tools) ถือเป็นเครื่องมือสำคัญในการวิเคราะห์และแก้ไขปัญหาเครือข่าย โดยสามารถให้ข้อมูลที่เกี่ยวข้องกับการทำงานในแต่ละชั้นของแบบจำลอง **OSI (Open Systems Interconnection Model)** ได้อย่างละเอียด ทั้งในระบบปฏิบัติการ **MS Windows** และ **Linux**

### เครื่องมือที่ใช้บ่อย

* **`ipconfig`** (Windows)
  ใช้แสดงการกำหนดค่าปัจจุบันของเครือข่าย TCP/IP ของโฮสต์ รวมถึง **IP Address**, **Subnet Mask**, **Default Gateway** และ **DNS Server** (อยู่ในชั้นที่ 3: Network Layer)
  คำสั่ง `/all` จะแสดงรายละเอียดเพิ่มเติม เช่น ค่า MAC Address และการตั้งค่า DHCP

  ```bash
  ipconfig
  ipconfig /all
  ```

* **`ping`**
  ส่งแพ็กเก็ต ICMP (Internet Control Message Protocol) แบบ Echo Request ไปยังโฮสต์ปลายทาง และรอการตอบกลับ เพื่อทดสอบการเชื่อมต่อพื้นฐานในระดับ IP (Layer 3)

  ```bash
  ping <destination_ip_or_hostname>
  ```

* **`tracert`** (Windows) / **`traceroute`** (Linux)
  ใช้ตรวจสอบเส้นทาง (Path) ของแพ็กเก็ตจากโฮสต์ต้นทางไปยังปลายทาง โดยแสดงอุปกรณ์เครือข่าย (Router) ที่แพ็กเก็ตผ่านแต่ละขั้นตอน ซึ่งช่วยระบุปัญหาที่เกี่ยวข้องกับการกำหนดเส้นทาง (Routing) (Layer 3)

  ```bash
  tracert <destination_ip_or_hostname>
  traceroute <destination_ip_or_hostname>
  ```

* **`netstat`**
  ใช้แสดงการเชื่อมต่อ TCP ที่กำลังทำงานอยู่, พอร์ตที่เปิดรับการเชื่อมต่อ, สถิติของ Ethernet, ตารางการกำหนดเส้นทาง (Routing Table) รวมถึงข้อมูลของโปรโตคอล IPv4/IPv6 (Layer 3 และ Layer 4)

  ```bash
  netstat -ano
  ```

* **`nslookup`**
  ใช้สอบถามเซิร์ฟเวอร์ DNS เพื่อแปลงชื่อโฮสต์ (Hostname) ไปเป็นที่อยู่ไอพี หรือกลับกัน (Layer 7 – Application Layer, อาศัยการทำงานของชั้นล่างประกอบ)

  ```bash
  nslookup <hostname_or_ip_address>
  ```

### ปัญหาการเชื่อมต่อที่พบบ่อยและแนวทางแก้ไข

| **อาการ (Symptom)**                          | **สาเหตุ (Cause)**                        | **แนวทางแก้ไข (Solution)**                  |
| -------------------------------------------- | ----------------------------------------- | ------------------------------------------- |
| ไม่สามารถใช้งานอินเทอร์เน็ตได้ (No Internet) | เกตเวย์กำหนดค่าไม่ถูกต้อง (Wrong Gateway) | กำหนดค่า IP ของ Gateway ใหม่ให้ถูกต้อง      |
| การแก้ไขชื่อโดเมนล้มเหลว (DNS Fails)         | DNS Server กำหนดค่าผิด                    | ใช้ DNS สาธารณะ เช่น 8.8.8.8                |
| ที่อยู่ IP ซ้ำกัน (IP Conflict)              | มีการตั้งค่า IP แบบ Static ซ้ำ            | เปลี่ยน IP หรือใช้ DHCP                     |
| ได้รับที่อยู่ APIPA                          | DHCP Server ไม่ตอบสนอง                    | ตรวจสอบการทำงานของ DHCP Server และสายสัญญาณ |

## Section 4: โปรโตคอลกำหนดค่าโฮสต์แบบไดนามิก (DHCP: Dynamic Host Configuration Protocol)

**DHCP (Dynamic Host Configuration Protocol)** คือ โปรโตคอลการจัดการเครือข่ายที่ใช้สำหรับการแจกจ่ายการตั้งค่า IP ให้กับอุปกรณ์ (Hosts) บนเครือข่ายโดยอัตโนมัติ ช่วยลดภาระในการกำหนดค่าด้วยตนเองและสร้างความสม่ำเสมอของการกำหนดค่า โดยเฉพาะในเครือข่ายที่มีอุปกรณ์จำนวนมาก

### วัตถุประสงค์ของ DHCP (Purpose of DHCP)

DHCP ช่วยลดข้อผิดพลาดจากการกำหนดค่าด้วยตนเอง และช่วยให้งานผู้ดูแลระบบ (Network Administrator) มีความสะดวกมากขึ้น โดยมอบการตั้งค่าหลักให้กับอุปกรณ์ ได้แก่:

* **IP Address (ที่อยู่ไอพี)**
* **Subnet Mask (มาสก์เครือข่ายย่อย)**
* **Default Gateway (เกตเวย์เริ่มต้น)**
* **DNS Server(s) (เซิร์ฟเวอร์ DNS)**

หากไม่มี DHCP ผู้ดูแลระบบจำเป็นต้องกำหนดค่าเหล่านี้ให้กับแต่ละอุปกรณ์ด้วยตนเอง ซึ่งเสี่ยงต่อการเกิดปัญหา เช่น การซ้ำกันของที่อยู่ไอพี (IP Conflict), การกำหนดค่า Subnet ไม่ถูกต้อง หรือการระบุ Gateway ที่ไม่สามารถใช้งานได้

### กระบวนการทำงานของ DHCP — ขั้นตอน DORA

เมื่ออุปกรณ์ที่รองรับ DHCP เชื่อมต่อเข้าสู่เครือข่าย จะมีกระบวนการ 4 ขั้นตอนในการขอรับการกำหนดค่า ซึ่งมักถูกเรียกย่อว่า **DORA** ได้แก่:

1. **Discover (การค้นหา):** ไคลเอนต์ส่งแพ็กเก็ต DHCP Discover แบบ Broadcast เพื่อค้นหาเซิร์ฟเวอร์ DHCP
2. **Offer (การเสนอ):** เซิร์ฟเวอร์ DHCP ตอบกลับด้วย DHCP Offer ที่มีที่อยู่ไอพีและการตั้งค่าอื่น ๆ ที่สามารถใช้งานได้
3. **Request (การร้องขอ):** ไคลเอนต์ส่ง DHCP Request ตอบกลับเพื่อยืนยันการยอมรับการกำหนดค่าที่เสนอมา
4. **Acknowledge (การยืนยัน):** เซิร์ฟเวอร์ DHCP ส่ง DHCP Acknowledgment (ACK) เพื่อยืนยันการเช่าที่อยู่ไอพี (IP Lease)


### ระยะเวลาเช่าและการต่ออายุ (Lease Duration and Renewal)

ที่อยู่ไอพีที่แจกจ่ายผ่าน DHCP จะถูกให้ในรูปแบบ **Lease (สัญญาเช่า)** ซึ่งมีอายุการใช้งานจำกัด เมื่อเวลาครบกำหนด อุปกรณ์ต้องทำการต่ออายุ (Renew) เพื่อรักษาการใช้งานต่อไป กลไกนี้ช่วยให้เครือข่ายสามารถนำที่อยู่ไอพีที่ไม่ได้ใช้งานกลับมาแจกจ่ายใหม่ได้อย่างมีประสิทธิภาพ

### การใช้งาน DHCP ในทางปฏิบัติ (DHCP in Practice)

* ในเครือข่ายบ้านหรือสำนักงานขนาดเล็ก **เราเตอร์ไร้สาย (Wireless Router)** มักทำหน้าที่เป็น DHCP Server โดยอัตโนมัติ
* ในเครือข่ายระดับองค์กร (Enterprise Network) จะใช้ **DHCP Server แบบรวมศูนย์ (Centralized DHCP Server)** และอาจมี **DHCP Relay Agent** เพื่อกระจายบริการไปยังหลายเครือข่ายย่อย (Subnets)

### คำสั่งบรรทัดคำสั่งที่เกี่ยวข้อง (Command-line Tip)

บนระบบปฏิบัติการ **Windows** สามารถใช้คำสั่งต่อไปนี้เพื่อตรวจสอบหรือแก้ไขปัญหาที่เกี่ยวข้องกับ DHCP ได้:

```bash
ipconfig /release
ipconfig /renew
```

* `ipconfig /release` – ปล่อย (Release) ที่อยู่ไอพีที่ได้รับจาก DHCP
* `ipconfig /renew` – ร้องขอ (Renew) ที่อยู่ไอพีใหม่จาก DHCP Server



